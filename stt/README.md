# 使用 Google Cloud STT 实现多语言自动识别

## 背景
有些时候，客户并不确定音频录音中会包含哪些语言。例如，如果在具有多种官方语言的国家/地区发布服务、应用或产品，则可能会接收用户以多种语言提供的音频输入。这种情况下，为转录请求指定单独一种语言代码的难度很大。

Google Cloud Speech To Text 提供了自动检测输入语音的功能，然而存在一些限制，最多支持指定 1 种主要语言以及 3 种备用语言。利用这个功能可以实现不多于 4 种语言的自动检测功能。

当客户需求多于 4 种语言时，直接使用 STT 多语言检测功能不能直接满足，因此本文档通过编写脚本的方式实现多于 4 种语言的自动检测。

## 实现逻辑
调用 STT 进行语音转文本时返回结果里主要包含转录文本，置信度，语言。经过测试发现，如果指定语言不正确，测出来请求返回有两种结果：1.空值，一般指定语言和真实语言完全不相关时会出现，比如真实语言是英语，指定成日语；2.低置信度的值，比如真实语言是法国法语，制定成了加拿大法语。当指定了备用语言时，将返回置信度最高的一种语言。

因此当输入语言多于 4 种时，考虑将语音列表进行分组，每组语言种类数量少于4种，每组语言调用一次 STT 转录功能返回一个结果，取置信度最高的一组的返回作为最后的结果。

在考虑每组语言数量时， STT 建议指定语言数量越少，语音识别的置信度越高，因此在本方案中，将每一组语言数量定为 2。

## Demo
修改 speech_transcribe_multi_language.py 中的 audio_gcs_uri 和 language_list 即可快速演示多语言功能，其他编程语言的实现逻辑可以参考此 python 代码进行修改。

## 参考
Cloud Speech-To-Text 自动检测多语言：https://cloud.google.com/speech-to-text/docs/multiple-languages 